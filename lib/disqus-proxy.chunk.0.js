webpackJsonp([0],[,,,,function(t,e,a){"use strict";function n(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,a){function n(o,i){try{var r=e[o](i),s=r.value}catch(t){return void a(t)}if(!r.done)return Promise.resolve(s).then(function(t){n("next",t)},function(t){n("throw",t)});t(s)}return n("next")})}}Object.defineProperty(e,"__esModule",{value:!0});var o=a(0),i=a.n(o),r=a(6),s=a(7),l=a(5);class c extends o.Component{constructor(t){super(t),this.state={comments:[],isFetchingComment:!0,notificationTitle:"",notificationBody:"",showNotification:!1}}componentWillMount(){var t=this;return n(function*(){const e=window.disqusProxy.identifier,a="identifier="+encodeURIComponent(e),n="//"+window.disqusProxy.server+":"+window.disqusProxy.port.toString()+"/api/getComments";try{const e=yield(yield fetch(n+"?"+a)).json();t.setState({isFetchingComment:!1}),0===e.code?t.setState({comments:e.response}):2!==e.code&&t.setState({notificationTitle:"评论获取错误",notificationBody:e.response,showNotification:!0})}catch(e){t.setState({isFetchingComment:!1,notificationTitle:"评论获取错误",notificationBody:e,showNotification:!0})}})()}render(){const{notificationTitle:t,notificationBody:e,showNotification:a,comments:n,isFetchingComment:o}=this.state;return i.a.createElement("div",{className:"disqus-proxy"},i.a.createElement("div",{className:"disqus-statement"},"您的网络连接在连接",i.a.createElement("a",{href:"https://disqus.com"}," disqus.com "),"时出现问题, 已为你展示精简版评论系统"),i.a.createElement(r.a,null),a&&i.a.createElement(l.a,{title:t,body:e,duration:5e4}),i.a.createElement(s.a,{comments:n,isLoading:o}))}}e.default=c},function(t,e,a){"use strict";var n=a(0),o=a.n(n),i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n])}return t};const r={notification:{boxSizing:"border-box",transition:"all 0.5s",position:"absolute",padding:16,borderRadius:6,minWidth:140,top:22,backgroundColor:"white",boxShadow:"0 2px 8px rgba(0, 0, 0, .2)"}};class s extends n.Component{constructor(t){super(t),this.state={show:!1}}componentDidMount(){setTimeout(()=>{this.setState({show:!0})},0),setTimeout(()=>{this.setState({show:!1})},this.props.duration)}render(){return o.a.createElement("div",{style:i({},r.notification,{right:this.state.show?40:"-100%"})},o.a.createElement("div",{style:{marginBottom:6,fontSize:14,color:"rgba(0, 0, 0, .85)"}},this.props.title),o.a.createElement("div",{style:{fontSize:12,color:"rgba(0, 0, 0, .65)"}},this.props.body))}}e.a=s},function(t,e,a){"use strict";function n(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,a){function n(o,i){try{var r=e[o](i),s=r.value}catch(t){return void a(t)}if(!r.done)return Promise.resolve(s).then(function(t){n("next",t)},function(t){n("throw",t)});t(s)}return n("next")})}}var o=a(0),i=a.n(o),r=a(5),s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n])}return t};const l={button:{transition:"all 0.4s",outline:"none",border:"none",color:"white",backgroundColor:"#42b983",cursor:"pointer"},label:{boxSizing:"border-box",display:"block",width:"220px",margin:"10px 0"},span:{display:"inline-block",width:"60px",fontSize:"12px"},input:{padding:"0 10px",boxSizing:"border-box",height:"22px",width:"160px",outline:"none",borderRadius:"4px"}};class c extends o.Component{constructor(t){super(t),this.handleChange=((t,e)=>{this.setState({[e]:t.target.value,[e+"Valid"]:!0})}),this.commentMetaToggle=(()=>{this.setState({showCommentMeta:!this.state.showCommentMeta})}),this.state={thread:null,message:"",authorName:"",authorEmail:"",authorNameValid:!0,authorEmailValid:!0,messageValid:!0,showCommentMeta:!1,disabled:!1,notificationTitle:"",notificationBody:"",showNotification:!1}}componentWillMount(){var t=this;return n(function*(){const e=window.disqusProxy.identifier,a="identifier="+encodeURIComponent(e),n="//"+window.disqusProxy.server+":"+window.disqusProxy.port.toString()+"/api/getThreads",o=yield(yield fetch(n+"?"+a)).json();if(0===o.code&&o.response.length){const e=o.response[0].id;t.setState({thread:e});const a=localStorage.getItem(e);"string"==typeof a&&t.setState({message:a})}else"number"==typeof o.code&&t.setState({notificationTitle:"thread 获取错误",notificationBody:o.response,showNotification:!0})})()}postComment(){var t=this;return n(function*(){if(!t.state.thread)return;t.setState({message:t.state.message.trim(),authorName:t.state.authorName.trim(),authorEmail:t.state.authorEmail.trim()});if(!function(){let e=!0;["message","authorName","authorEmail"].forEach(function(a){""===t.state[a]&&(e=!1,t.setState({[a+"Valid"]:!1}))});const a=t.state.authorEmail;return/^[-a-zA-Z0-9.]+@[-a-zA-Z0-9]+\.[-a-zA-Z0-9]+$/.test(a)||(e=!1,t.setState({authorEmailValid:!1})),e}())return!1;t.setState({disabled:!0}),localStorage.setItem(t.state.thread.toString(),t.state.message);const e={thread:t.state.thread,author_name:t.state.authorName,author_email:t.state.authorEmail,message:t.state.message},a="//"+window.disqusProxy.server+":"+window.disqusProxy.port.toString()+"/api/createComment";return fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})})()}submit(){var t=this;return n(function*(){if(t.state.disabled)return;const e=yield t.postComment();if(!e)return;const a=yield e.json();t.setState({disabled:!1}),0===a.code?(localStorage.removeItem(t.state.thread),t.setState({message:"",authorName:"",authorEmail:"",showCommentMeta:!1,notificationTitle:"发表成功",notificationBody:"请等待审核",showNotification:!0}),setTimeout(function(){t.setState({showNotification:!1})},5e3)):"number"==typeof a.code&&(t.setState({notificationTitle:"发表失败",notificationBody:a.response,showNotification:!0}),setTimeout(function(){t.setState({showNotification:!1})},5e3))})()}render(){return i.a.createElement("div",{style:{padding:"10px 20px",position:"relative",overflow:"hidden"}},i.a.createElement("div",{style:{height:"110px",position:"relative"}},i.a.createElement("div",{style:{position:"absolute",paddingTop:"6px"}},i.a.createElement("img",{src:window.disqusProxy.defaultAvatar,alt:"avatar",style:{width:"50px",height:"50px",borderRadius:"50%",boxShadow:"1px 1px 3px 0.5px #ccc"}})),i.a.createElement("textarea",{value:this.state.message,style:{position:"absolute",top:"0",left:"70px",width:"calc(100% - 70px)",height:"100px",boxSizing:"border-box",fontSize:"16px",letterSpacing:"0.7px",padding:"12px",color:"#555",backgroundColor:"#f8f8f8",outline:"none",border:this.state.messageValid?"none":"border: 1px solid #ff7500",resize:"none",borderRadius:"8px",overflow:"auto",boxShadow:"1px 1px 2px -1px #aaa"},disabled:this.state.disabled,onChange:t=>this.handleChange(t,"message")})),this.state.showNotification&&i.a.createElement(r.a,{title:this.state.notificationTitle,body:this.state.notificationBody,duration:4e3}),i.a.createElement("button",{style:s({},l.button,{fontSize:"14px",marginLeft:"calc(100% - 46px)",padding:"2px 16px",borderRadius:"4px"}),onClick:this.commentMetaToggle},i.a.createElement("i",{className:"fa fa-comment-o","aria-hidden":"true"})),i.a.createElement("div",{style:{marginLeft:"calc(100% - 220px)",transition:"all 0.5s",color:"#666",overflow:"hidden",height:this.state.showCommentMeta?120:0}},i.a.createElement("label",{style:l.label},i.a.createElement("span",{style:l.span},i.a.createElement("i",{className:"fa fa-user-o","aria-hidden":"true"})," 昵称 "),i.a.createElement("input",{type:"text",style:s({},l.input,{border:this.state.authorNameValid?"1px solid #ccc":" 1px solid #ff7500"}),value:this.state.authorName,disabled:this.state.disabled,onChange:t=>this.handleChange(t,"authorName")})),i.a.createElement("label",{style:l.label},i.a.createElement("span",{style:l.span},i.a.createElement("i",{className:"fa fa-envelope-o","aria-hidden":"true"})," 邮箱 "),i.a.createElement("input",{type:"text",style:s({},l.input,{border:this.state.authorEmailValid?"1px solid #ccc":" 1px solid #ff7500"}),value:this.state.authorEmail,disabled:this.state.disabled,onChange:t=>this.handleChange(t,"authorEmail")})),i.a.createElement("button",{onClick:()=>this.submit(),style:s({},l.button,{marginLeft:"calc(100% - 46px)",outline:"none",borderRadius:"4px",height:"24px",width:"46px",border:"none"})},i.a.createElement("i",{className:"fa fa-share","aria-hidden":"true"}))))}}e.a=c},function(t,e,a){"use strict";var n=a(0),o=a.n(n),i=a(8);class r extends n.Component{render(){function t(e){if(0===r.length)return null;const a=[];for(const n of r)n.parent===e&&a.unshift({comment:n,author:n.author.name,isPrimary:n.author.username===window.disqusProxy.shortname,children:t(+n.id)});return a.length?a:null}const{comments:e,isLoading:a}=this.props,n=[],r=[];e.forEach(function(t){(t.parent?r:n).push(t)});const s=n.map(e=>({comment:e,author:e.author.name,isPrimary:e.author.username===window.disqusProxy.shortname,children:t(+e.id)}));return o.a.createElement("div",{style:{overflowX:"auto"}},a?o.a.createElement("div",{style:{textAlign:"center",color:"#ccc",fontSize:14}},"评论加载中 ",o.a.createElement("i",{className:"fa fa-spinner fa-spin fa-fw"})):s.length?o.a.createElement("ul",null,s.map(t=>o.a.createElement("li",{key:t.comment.id},o.a.createElement(i.a,{comment:t.comment,children:t.children,isPrimary:t.isPrimary,author:t.author})))):o.a.createElement("div",{style:{textAlign:"center",color:"#ccc",fontSize:14}},"还没有评论呢"))}}e.a=r},function(t,e,a){"use strict";function n(t){return i.a.createElement("div",{style:{padding:"0 10px"}},i.a.createElement("div",{style:{display:"inline-block"}},i.a.createElement("img",{src:t.isPrimary?window.disqusProxy.adminAvatar:window.disqusProxy.defaultAvatar,style:{width:40,height:40,borderRadius:"50%",boxShadow:" 1px 1px 3px 0.5px #ccc"},alt:"avatar"})),i.a.createElement("div",{style:{margin:"-60px 0 0 60px"}},i.a.createElement("p",{className:"comment-header"},i.a.createElement("span",{style:r({},s.span,{color:"#888",fontSize:14})},t.comment.author.name),t.isPrimary&&i.a.createElement("span",{style:r({},s.span,{boxSizing:"border-box",lineHeight:"16px",fontSize:12,backgroundColor:"#aaa",color:"white",padding:"0 3px",borderRadius:4})},"Admin"),t.replyTo&&i.a.createElement("span",{style:r({},s.span,{color:"#888",fontSize:14})},i.a.createElement("i",{className:"fa fa-share",style:{color:"#42b983",display:"inline-block",marginRight:10}}),t.replyTo),i.a.createElement("span",{style:r({},s.span,{color:"#bbb",fontSize:12,fontFamily:"'calligraffittiregular', sans-serif"})},window.moment(t.comment.createdAt).utcOffset(-8).format("YYYY/MM/DD HH : mm"))),i.a.createElement("p",{className:"comment-body",style:{fontSize:14,color:"#34495e"},dangerouslySetInnerHTML:{__html:t.comment.message}})),t.children&&t.children.length>0&&i.a.createElement("ul",{className:"post-reply"},t.children.map(e=>i.a.createElement("li",{key:e.comment.id},i.a.createElement(n,{comment:e.comment,author:e.author,isPrimary:e.isPrimary,replyTo:t.author,children:e.children})))))}e.a=n;var o=a(0),i=a.n(o),r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n])}return t};const s={span:{display:"inline-block",marginRight:10}}}]);