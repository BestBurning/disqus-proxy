!function(e){function t(a){if(n[a])return n[a].exports;var o=n[a]={i:a,l:!1,exports:{}};return e[a].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,a){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:a})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/scripts/",t(t.s=2)}([function(e,t){e.exports=React},function(e,t,n){"use strict";var a=n(0),o=n.n(a),i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e};const s={notification:{boxSizing:"border-box",transition:"all 0.5s",position:"absolute",padding:16,borderRadius:6,minWidth:140,top:22,backgroundColor:"white",boxShadow:"0 2px 8px rgba(0, 0, 0, .2)"}};class r extends a.Component{constructor(e){super(e),this.state={show:!1}}componentDidMount(){setTimeout(()=>{this.setState({show:!0})},0),setTimeout(()=>{this.setState({show:!1})},this.props.duration)}render(){return o.a.createElement("div",{style:i({},s.notification,{right:this.state.show?40:"-100%"})},o.a.createElement("div",{style:{marginBottom:6,fontSize:14,color:"rgba(0, 0, 0, .85)"}},this.props.title),o.a.createElement("div",{style:{fontSize:12,color:"rgba(0, 0, 0, .65)"}},this.props.body))}}t.a=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),o=n.n(a),i=n(3),s=n.n(i),r=n(4);const c=document.getElementById("disqus_proxy_thread");let l=document.getElementById("disqus-thread");c&&!l&&((l=document.createElement("div")).id="disqus_thread",c.parentNode.appendChild(l),s.a.render(o.a.createElement(r.a,null),c))},function(e,t){e.exports=ReactDOM},function(e,t,n){"use strict";function a(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function a(o,i){try{var s=t[o](i),r=s.value}catch(e){return void n(e)}if(!s.done)return Promise.resolve(r).then(function(e){a("next",e)},function(e){a("throw",e)});e(r)}return a("next")})}}var o=n(0),i=n.n(o),s=n(5);class r extends o.Component{constructor(e){super(e),this.state={disqusLoaded:!1,isLoading:!0}}componentWillMount(){var e=this;return a(function*(){try{const t=fetch(`https://disqus.com/next/config.json?timestamp=${+new Date}`),n=new Promise(function(e){return setTimeout(function(){return e({status:600})},2e3)});200!==(yield Promise.race([t,n])).status&&(console.warn("pre-test loading failed, load disqus-proxy instead"),e.setState({isLoading:!1}));const a=document.createElement("script"),o=window.disqusProxy.shortname;a.src=`https://${o}.disqus.com/embed.js`,a.async=!0,a.setAttribute("data-timestamp",String(+new Date)),a.onload=function(){e.state.isLoading&&e.setState({isLoading:!1,disqusLoaded:!0})},a.onerror=function(){document.getElementById("disqus_thread").style.display="none",e.setState({isLoading:!1}),console.warn("Failed to load disqus. Load disqus-proxy instead.")},setTimeout(function(){e.state.disqusLoaded||(e.setState({isLoading:!1}),document.getElementById("disqus_thread").style.display="none")},3e3),document.body.appendChild(a)}catch(t){console.warn(t),e.setState({isLoading:!1}),document.getElementById("disqus_thread").style.display="none"}})()}render(){const{disqusLoaded:e,isLoading:t}=this.state;return t?i.a.createElement("div",{className:"disqus-statement"},i.a.createElement("span",null,"正在尝试加载",i.a.createElement("a",{href:"https://disqus.com",rel:"noopener noreferrer",target:"_blank"}," disqus "),"评论系统"),i.a.createElement("i",{className:"fa fa-spinner fa-spin fa-fw"})):!e&&i.a.createElement(s.a,null)}}t.a=r},function(e,t,n){"use strict";function a(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function a(o,i){try{var s=t[o](i),r=s.value}catch(e){return void n(e)}if(!s.done)return Promise.resolve(r).then(function(e){a("next",e)},function(e){a("throw",e)});e(r)}return a("next")})}}var o=n(0),i=n.n(o),s=n(6),r=n(7),c=n(1);class l extends o.Component{constructor(e){super(e),this.state={comments:[],isFetchingComment:!0,notificationTitle:"",notificationBody:"",showNotification:!1}}componentWillMount(){var e=this;return a(function*(){const t=window.disqusProxy.identifier,n="identifier="+encodeURIComponent(t),a="//"+window.disqusProxy.server+":"+window.disqusProxy.port.toString()+"/api/getComments";try{const t=yield(yield fetch(a+"?"+n)).json();e.setState({isFetchingComment:!1}),0===t.code?e.setState({comments:t.response}):2!==t.code&&e.setState({notificationTitle:"评论获取错误",notificationBody:t.response,showNotification:!0})}catch(t){e.setState({isFetchingComment:!1,notificationTitle:"评论获取错误",notificationBody:t.message,showNotification:!0})}})()}render(){const{notificationTitle:e,notificationBody:t,showNotification:n,comments:a,isFetchingComment:o}=this.state;return i.a.createElement("div",{className:"disqus-proxy"},i.a.createElement("div",{className:"disqus-statement"},"您的网络连接在连接",i.a.createElement("a",{href:"https://disqus.com"}," disqus.com "),"时出现问题, 已为你展示精简版评论系统"),i.a.createElement(s.a,null),n&&i.a.createElement(c.a,{title:e,body:t,duration:5e4}),i.a.createElement(r.a,{comments:a,isLoading:o}))}}t.a=l},function(e,t,n){"use strict";function a(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function a(o,i){try{var s=t[o](i),r=s.value}catch(e){return void n(e)}if(!s.done)return Promise.resolve(r).then(function(e){a("next",e)},function(e){a("throw",e)});e(r)}return a("next")})}}var o=n(0),i=n.n(o),s=n(1),r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e};const c={button:{transition:"all 0.4s",outline:"none",border:"none",color:"white",backgroundColor:"#42b983",cursor:"pointer"},label:{boxSizing:"border-box",display:"block",width:"220px",margin:"10px 0"},span:{display:"inline-block",width:"60px",fontSize:"12px"},input:{padding:"0 10px",boxSizing:"border-box",height:"22px",width:"160px",outline:"none",borderRadius:"4px"}};class l extends o.Component{constructor(e){super(e),this.handleChange=((e,t)=>{this.setState({[t]:e.target.value,[t+"Valid"]:!0})}),this.commentMetaToggle=(()=>{this.setState({showCommentMeta:!this.state.showCommentMeta})}),this.state={thread:null,message:"",authorName:"",authorEmail:"",authorNameValid:!0,authorEmailValid:!0,messageValid:!0,showCommentMeta:!1,disabled:!1,notificationTitle:"",notificationBody:"",showNotification:!1}}componentWillMount(){var e=this;return a(function*(){const t=window.disqusProxy.identifier,n="identifier="+encodeURIComponent(t),a="//"+window.disqusProxy.server+":"+window.disqusProxy.port.toString()+"/api/getThreads",o=yield(yield fetch(a+"?"+n)).json();if(0===o.code&&o.response.length){const t=o.response[0].id;e.setState({thread:t});const n=localStorage.getItem(t);"string"==typeof n&&e.setState({message:n})}else"number"==typeof o.code&&e.setState({notificationTitle:"thread 获取错误",notificationBody:o.response,showNotification:!0})})()}postComment(){var e=this;return a(function*(){if(!e.state.thread)return;e.setState({message:e.state.message.trim(),authorName:e.state.authorName.trim(),authorEmail:e.state.authorEmail.trim()});if(!function(){let t=!0;["message","authorName","authorEmail"].forEach(function(n){""===e.state[n]&&(t=!1,e.setState({[n+"Valid"]:!1}))});const n=e.state.authorEmail;return/^[-a-zA-Z0-9.]+@[-a-zA-Z0-9]+\.[-a-zA-Z0-9]+$/.test(n)||(t=!1,e.setState({authorEmailValid:!1})),t}())return!1;e.setState({disabled:!0}),localStorage.setItem(e.state.thread.toString(),e.state.message);const t={thread:e.state.thread,author_name:e.state.authorName,author_email:e.state.authorEmail,message:e.state.message},n="//"+window.disqusProxy.server+":"+window.disqusProxy.port.toString()+"/api/createComment";return fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})})()}submit(){var e=this;return a(function*(){if(e.state.disabled)return;const t=yield e.postComment();if(!t)return;const n=yield t.json();e.setState({disabled:!1}),0===n.code?(localStorage.removeItem(e.state.thread),e.setState({message:"",authorName:"",authorEmail:"",showCommentMeta:!1,notificationTitle:"发表成功",notificationBody:"请等待审核",showNotification:!0}),setTimeout(function(){e.setState({showNotification:!1})},5e3)):"number"==typeof n.code&&(e.setState({notificationTitle:"发表失败",notificationBody:n.response,showNotification:!0}),setTimeout(function(){e.setState({showNotification:!1})},5e3))})()}render(){return i.a.createElement("div",{style:{padding:"10px 20px",position:"relative",overflow:"hidden"}},i.a.createElement("div",{style:{height:"110px",position:"relative"}},i.a.createElement("div",{style:{position:"absolute",paddingTop:"6px"}},i.a.createElement("img",{src:window.disqusProxy.defaultAvatar,alt:"avatar",style:{width:"50px",height:"50px",borderRadius:"50%",boxShadow:"1px 1px 3px 0.5px #ccc"}})),i.a.createElement("textarea",{value:this.state.message,style:{position:"absolute",top:"0",left:"70px",width:"calc(100% - 70px)",height:"100px",boxSizing:"border-box",fontSize:"16px",letterSpacing:"0.7px",padding:"12px",color:"#555",backgroundColor:"#f8f8f8",outline:"none",border:this.state.messageValid?"none":"border: 1px solid #ff7500",resize:"none",borderRadius:"8px",overflow:"auto",boxShadow:"1px 1px 2px -1px #aaa"},disabled:this.state.disabled,onChange:e=>this.handleChange(e,"message")})),this.state.showNotification&&i.a.createElement(s.a,{title:this.state.notificationTitle,body:this.state.notificationBody,duration:4e3}),i.a.createElement("button",{style:r({},c.button,{fontSize:"14px",marginLeft:"calc(100% - 46px)",padding:"2px 16px",borderRadius:"4px"}),onClick:this.commentMetaToggle},i.a.createElement("i",{className:"fa fa-comment-o","aria-hidden":"true"})),i.a.createElement("div",{style:{marginLeft:"calc(100% - 220px)",transition:"all 0.5s",color:"#666",overflow:"hidden",height:this.state.showCommentMeta?120:0}},i.a.createElement("label",{style:c.label},i.a.createElement("span",{style:c.span},i.a.createElement("i",{className:"fa fa-user-o","aria-hidden":"true"})," 昵称 "),i.a.createElement("input",{type:"text",style:r({},c.input,{border:this.state.authorNameValid?"1px solid #ccc":" 1px solid #ff7500"}),value:this.state.authorName,disabled:this.state.disabled,onChange:e=>this.handleChange(e,"authorName")})),i.a.createElement("label",{style:c.label},i.a.createElement("span",{style:c.span},i.a.createElement("i",{className:"fa fa-envelope-o","aria-hidden":"true"})," 邮箱 "),i.a.createElement("input",{type:"text",style:r({},c.input,{border:this.state.authorEmailValid?"1px solid #ccc":" 1px solid #ff7500"}),value:this.state.authorEmail,disabled:this.state.disabled,onChange:e=>this.handleChange(e,"authorEmail")})),i.a.createElement("button",{onClick:()=>this.submit(),style:r({},c.button,{marginLeft:"calc(100% - 46px)",outline:"none",borderRadius:"4px",height:"24px",width:"46px",border:"none"})},i.a.createElement("i",{className:"fa fa-share","aria-hidden":"true"}))))}}t.a=l},function(e,t,n){"use strict";var a=n(0),o=n.n(a),i=n(8);class s extends a.Component{render(){function e(t){if(0===s.length)return null;const n=[];for(const a of s)a.parent===t&&n.unshift({comment:a,author:a.author.name,isPrimary:a.author.username===window.disqusProxy.shortname,children:e(+a.id)});return n.length?n:null}const{comments:t,isLoading:n}=this.props,a=[],s=[];t.forEach(function(e){(e.parent?s:a).push(e)});const r=a.map(t=>({comment:t,author:t.author.name,isPrimary:t.author.username===window.disqusProxy.shortname,children:e(+t.id)}));return o.a.createElement("div",{style:{overflowX:"auto"}},n?o.a.createElement("div",{style:{textAlign:"center",color:"#ccc",fontSize:14}},"评论加载中 ",o.a.createElement("i",{className:"fa fa-spinner fa-spin fa-fw"})):r.length?o.a.createElement("ul",null,r.map(e=>o.a.createElement("li",{key:e.comment.id},o.a.createElement(i.a,{comment:e.comment,children:e.children,isPrimary:e.isPrimary,author:e.author})))):o.a.createElement("div",{style:{textAlign:"center",color:"#ccc",fontSize:14}},"还没有评论呢"))}}t.a=s},function(e,t,n){"use strict";function a(e){return i.a.createElement("div",{style:{padding:"0 10px"}},i.a.createElement("div",{style:{display:"inline-block"}},i.a.createElement("img",{src:e.isPrimary?window.disqusProxy.adminAvatar:window.disqusProxy.defaultAvatar,style:{width:40,height:40,borderRadius:"50%",boxShadow:" 1px 1px 3px 0.5px #ccc"},alt:"avatar"})),i.a.createElement("div",{style:{margin:"-60px 0 0 60px"}},i.a.createElement("p",{className:"comment-header"},i.a.createElement("span",{style:s({},r.span,{color:"#888",fontSize:14})},e.comment.author.name),e.isPrimary&&i.a.createElement("span",{style:s({},r.span,{boxSizing:"border-box",lineHeight:"16px",fontSize:12,backgroundColor:"#aaa",color:"white",padding:"0 3px",borderRadius:4})},"Admin"),e.replyTo&&i.a.createElement("span",{style:s({},r.span,{color:"#888",fontSize:14})},i.a.createElement("i",{className:"fa fa-share",style:{color:"#42b983",display:"inline-block",marginRight:10}}),e.replyTo),i.a.createElement("span",{style:s({},r.span,{color:"#bbb",fontSize:12,fontFamily:"'calligraffittiregular', sans-serif"})},window.moment(e.comment.createdAt).utcOffset(-8).format("YYYY/MM/DD HH : mm"))),i.a.createElement("p",{className:"comment-body",style:{fontSize:14,color:"#34495e"},dangerouslySetInnerHTML:{__html:e.comment.message}})),e.children&&e.children.length>0&&i.a.createElement("ul",{className:"post-reply"},e.children.map(t=>i.a.createElement("li",{key:t.comment.id},i.a.createElement(a,{comment:t.comment,author:t.author,isPrimary:t.isPrimary,replyTo:e.author,children:t.children})))))}t.a=a;var o=n(0),i=n.n(o),s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e};const r={span:{display:"inline-block",marginRight:10}}}]);